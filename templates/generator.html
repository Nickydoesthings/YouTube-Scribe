{% extends "base.html" %}

{% set no_container = True %}

{% block content %}

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">YouTube -> Written Instructions</h1>
            <p class="hero-subtitle">Cut through the noise. Get right to the important details.</p>
            <div class="hero-search">
                <form id="generatorForm" action="/" method="POST">
                    <!-- Input field for the YouTube URL with styling similar to landing page -->
                    <input type="url" name="youtubeLink" id="youtubeLink" placeholder="Paste YouTube URL here" class="hero-input" required>
                    <button type="submit" class="hero-btn">
                        <img src="{{ url_for('static', filename='images/search.svg') }}" alt="Submit" class="search-icon">
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Spinner and Text Container -->
    <div id="loadingContainer" class="loading-container" style="display: none; text-align: center; margin-top: 20px;">
        <div id="loadingSpinner" class="loading-spinner"></div>
        <div id="loadingText" class="loading-text">Analyzing...</div>
    </div>

    <!-- Result Section -->
    <div id="resultContainer" style="margin-top: 30px;">
        {% if summary %}
            <!-- If a summary is generated, display it here -->
            <div class="summary-output">
                <h2>Generated Tutorial Summary:</h2>
                <div class="tutorial-content">
                    {{ summary | safe }} <!-- Render the Markdown content as HTML -->
                </div>
                <!-- Button to download the summary as a PDF -->
                <form method="GET" action="/download/pdf">
                    <input type="hidden" name="summary" value="{{ summary | safe }}">
                    <button type="submit" class="btn btn-secondary mt-3">Download as PDF</button>
                </form>
            </div>
        {% endif %}

        {% if error %}
            <!-- If there's an error, display it here -->
            <div class="alert alert-danger mt-3">
                <strong>Error:</strong> {{ error }}
            </div>
        {% endif %}
    </div>

    <!-- JavaScript to handle form submission and loading spinner -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById('generatorForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the form from submitting traditionally

            // Show the spinner and the "Analyzing..." text when the form is submitted
            document.getElementById('loadingContainer').style.display = 'block';

            // Collect the form data
            const formData = new FormData(this);

            // Perform the AJAX request
            fetch('/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.text())
            .then(data => {
                // Hide the spinner and loading text
                document.getElementById('loadingContainer').style.display = 'none';

                // Update only the summary section
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');
                const newSummary = doc.querySelector('.summary-output');
                const resultContainer = document.getElementById('resultContainer');

                // Clear the previous content
                resultContainer.innerHTML = '';

                // Append the new summary content
                if (newSummary) {
                    resultContainer.appendChild(newSummary);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('loadingContainer').style.display = 'none';
                document.getElementById('resultContainer').innerHTML = '<div class="alert alert-danger mt-3"><strong>Error:</strong> Something went wrong. Please try again later.</div>';
            });
        });
    });
    </script>

{% endblock %}
