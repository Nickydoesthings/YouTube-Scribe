{% extends "base.html" %}

{% set no_container = True %}

{% block content %}

    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">YouTube -> Written Instructions</h1>
            <p class="hero-subtitle">Cut through the noise. Get right to the important details.</p>
            <div class="hero-search">
                <form id="generatorForm" action="{{ url_for('generator') }}" method="POST">
                    <input type="url" name="youtubeLink" id="youtubeLink" value="{{ request.args.get('youtubeLink', '') }}" placeholder="Paste YouTube URL here" class="hero-input" required>
                    <button type="submit" class="hero-btn">
                        <img src="{{ url_for('static', filename='images/search.svg') }}" alt="Submit" class="search-icon">
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Spinner and Text Container -->
    <div id="loadingContainer" class="loading-container" style="display: none; text-align: center; margin-top: 20px;">
        <div id="loadingSpinner" class="loading-spinner"></div>
        <div id="loadingText" class="loading-text">Analyzing...</div>
    </div>

    <div id="resultContainer" style="margin-top: 30px;">
        {% if summary %}
            <!-- Container for the generated summary with some styling -->
            <div class="summary-output-container" style="border: 1px solid #ccc; border-radius: 8px; padding: 20px; background-color: #f9f9f9;">
                <div class="tutorial-content">
                    {{ summary | safe }} <!-- Render the Markdown content as HTML -->
                </div>
                <!-- Button to download the summary as a PDF -->
                <form method="GET" action="/download/pdf">
                    <input type="url" name="youtubeLink" id="youtubeLink" value="{{ request.args.get('youtubeLink', '') }}" placeholder="Paste YouTube URL here" class="hero-input" required>

                    <button type="submit" class="btn btn-secondary mt-3">Download as PDF</button>
                </form>
            </div>
        {% endif %}

        {% if error %}
            <div class="alert alert-danger mt-3">
                <strong>Error:</strong> {{ error }}
            </div>
        {% endif %}
    </div>

    <!-- JavaScript to handle form submission and loading spinner -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const form = document.getElementById('generatorForm');
            const youtubeLink = document.getElementById('youtubeLink').value;

            // Function to show the loading spinner
            function showLoadingSpinner() {
                document.getElementById('loadingContainer').style.display = 'block';
            }

            // Check if there's a YouTube link (redirect from landing page) and auto-submit the form
            if (youtubeLink) {
                showLoadingSpinner();  // Show spinner before auto-submit
                form.submit();
            }

            // Add the event listener for manual submission to also show the spinner
            form.addEventListener('submit', function(event) {
                showLoadingSpinner();  // Show spinner for manual submission
            });
        });
    </script>

{% endblock %}

